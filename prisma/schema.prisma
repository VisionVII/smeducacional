generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model PublicPageLog {
  id        String     @id @default(cuid())
  pageId    String
  userId    String
  action    String
  changes   Json?
  createdAt DateTime   @default(now())
  page      PublicPage @relation(fields: [pageId], references: [id])
  user      User       @relation(fields: [userId], references: [id])
}

model PublicPage {
  id          String          @id @default(cuid())
  slug        String          @unique
  title       String
  description String?
  bannerUrl   String?
  iconUrl     String?
  content     Json?
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  isPublished Boolean         @default(false)
  logs        PublicPageLog[]
  version     Int             @default(1)
  publishedAt DateTime?
}

model AuditReport {
  id        String   @id @default(uuid())
  userId    String
  result    Json
  pdfUrl    String?
  riskScore Int
  status    String
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}

model User {
  id                        String                     @id @default(cuid())
  name                      String
  email                     String                     @unique
  password                  String?
  role                      UserRole                   @default(STUDENT)
  avatar                    String?
  phone                     String?
  bio                       String?
  cpf                       String?
  address                   String?
  twoFactorEnabled          Boolean                    @default(false)
  twoFactorSecret           String?
  emailVerified             DateTime?
  resetCode                 String?
  resetCodeExpires          DateTime?
  deletedAt                 DateTime?
  createdAt                 DateTime                   @default(now())
  updatedAt                 DateTime                   @updatedAt
  landingConfig             Json?
  landingTheme              Json?
  auditReports              AuditReport[]
  publicPageLogs            PublicPageLog[]
  activities                Activity[]                 @relation("ActivityCreator")
  activityLogs              ActivityLog[]
  auditLogs                 AuditLog[]
  notificationLogs          NotificationLog[]
  certificates              Certificate[]
  checkoutSessions          CheckoutSession[]
  createdCourses            Course[]                   @relation("CourseCreator")
  enrollments               Enrollment[]
  githubIntegration         GithubIntegration?
  invoices                  Invoice[]
  receivedMessages          Message[]                  @relation("MessageReceiver")
  sentMessages              Message[]                  @relation("MessageSender")
  notifications             Notification[]
  payments                  Payment[]
  progress                  Progress[]
  studentEnrollmentPayments StudentEnrollmentPayment[]
  studentSubscription       StudentSubscription?
  submissions               Submission[]
  supportTickets            SupportTicket[]
  systemLogs                SystemLog[]
  teacherEducation          TeacherEducation[]
  teacherFinancial          TeacherFinancial?
  teacherSubscription       TeacherSubscription?
  theme                     UserTheme?
  payouts                   Payout[]
  teacherAds                Advertisement[]            @relation("TeacherAds")

  @@map("users")
}

model PublicSiteConfig {
  id        String   @id @default(cuid())
  slug      String   @unique
  theme     Json?
  content   Json?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("public_site_configs")
}

model Category {
  id          String   @id @default(cuid())
  name        String   @unique
  slug        String   @unique
  description String?
  icon        String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  courses     Course[]

  @@map("categories")
}

model Course {
  id                        String                     @id @default(cuid())
  title                     String
  slug                      String                     @unique
  description               String
  thumbnail                 String?
  duration                  Int?
  level                     String?
  price                     Float?
  isPaid                    Boolean                    @default(false)
  isPublished               Boolean                    @default(false)
  publishedAt               DateTime?
  isFeatured                Boolean                    @default(false)
  featuredAt                DateTime?
  requirements              String?
  whatYouLearn              String?
  categoryId                String
  instructorId              String
  deletedAt                 DateTime?
  createdAt                 DateTime                   @default(now())
  updatedAt                 DateTime                   @updatedAt
  compareAtPrice            Float?
  certificates              Certificate[]
  checkoutSessions          CheckoutSession[]
  category                  Category                   @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  instructor                User                       @relation("CourseCreator", fields: [instructorId], references: [id], onDelete: Cascade)
  enrollments               Enrollment[]
  invoices                  Invoice[]
  modules                   Module[]
  payments                  Payment[]
  studentEnrollmentPayments StudentEnrollmentPayment[]
  advertisements            Advertisement[]
  promotedInConfig          SystemConfig[]             @relation("PromotedCourse")

  @@index([categoryId])
  @@index([instructorId])
  @@index([slug])
  @@map("courses")
}

model Module {
  id          String   @id @default(cuid())
  title       String
  description String?
  order       Int
  courseId    String
  deletedAt   DateTime?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  lessons     Lesson[]
  course      Course     @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@index([courseId])
  @@map("modules")
}

model Lesson {
  id          String     @id @default(cuid())
  title       String
  description String?
  content     String?
  videoUrl    String?
  duration    Int?
  order       Int
  isFree      Boolean    @default(false)
  moduleId    String
  deletedAt   DateTime?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  module      Module     @relation(fields: [moduleId], references: [id], onDelete: Cascade)
  materials   Material[]
  progress    Progress[]

  @@index([moduleId])
  @@map("lessons")
}

model Material {
  id        String   @id @default(cuid())
  title     String
  type      String
  url       String
  size      Int?
  lessonId  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  lesson    Lesson   @relation(fields: [lessonId], references: [id], onDelete: Cascade)

  @@index([lessonId])
  @@map("materials")
}

model Enrollment {
  id          String           @id @default(cuid())
  status      EnrollmentStatus @default(ACTIVE)
  progress    Float            @default(0)
  studentId   String
  courseId    String
  enrolledAt  DateTime         @default(now())
  completedAt DateTime?
  updatedAt   DateTime         @updatedAt
  course      Course           @relation(fields: [courseId], references: [id], onDelete: Cascade)
  student     User             @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([studentId, courseId])
  @@index([studentId])
  @@index([courseId])
  @@map("enrollments")
}

model Progress {
  id           String    @id @default(cuid())
  studentId    String
  lessonId     String
  isCompleted  Boolean   @default(false)
  watchTime    Int       @default(0)
  lastPosition Int       @default(0)
  completedAt  DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  lesson       Lesson    @relation(fields: [lessonId], references: [id], onDelete: Cascade)
  student      User      @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([studentId, lessonId])
  @@index([studentId])
  @@index([lessonId])
  @@map("progress")
}

model Certificate {
  id                String    @id @default(cuid())
  certificateNumber String    @unique
  studentId         String
  courseId          String
  issuedAt          DateTime  @default(now())
  validUntil        DateTime?
  course            Course    @relation(fields: [courseId], references: [id], onDelete: Cascade)
  student           User      @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@index([studentId])
  @@index([courseId])
  @@map("certificates")
}

model Activity {
  id          String       @id @default(cuid())
  title       String
  description String
  type        ActivityType
  dueDate     DateTime?
  maxScore    Float        @default(100)
  moduleId    String?
  createdById String
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  createdBy   User         @relation("ActivityCreator", fields: [createdById], references: [id], onDelete: Cascade)
  grades      Grade[]
  submissions Submission[]

  @@index([createdById])
  @@map("activities")
}

model Submission {
  id          String   @id @default(cuid())
  content     String
  fileUrl     String?
  studentId   String
  activityId  String
  submittedAt DateTime @default(now())
  updatedAt   DateTime @updatedAt
  grade       Grade?
  activity    Activity @relation(fields: [activityId], references: [id], onDelete: Cascade)
  student     User     @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@index([studentId])
  @@index([activityId])
  @@map("submissions")
}

model Grade {
  id           String     @id @default(cuid())
  score        Float
  feedback     String?
  submissionId String     @unique
  studentId    String
  activityId   String
  gradedById   String
  gradedAt     DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  activity     Activity   @relation(fields: [activityId], references: [id], onDelete: Cascade)
  submission   Submission @relation(fields: [submissionId], references: [id], onDelete: Cascade)

  @@index([studentId])
  @@index([activityId])
  @@index([gradedById])
  @@map("grades")
}

model Notification {
  id        String           @id @default(cuid())
  title     String
  message   String
  type      NotificationType
  isRead    Boolean          @default(false)
  userId    String
  createdAt DateTime         @default(now())
  user      User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("notifications")
}

model Message {
  id         String   @id @default(cuid())
  subject    String
  content    String
  isRead     Boolean  @default(false)
  senderId   String
  receiverId String
  createdAt  DateTime @default(now())
  receiver   User     @relation("MessageReceiver", fields: [receiverId], references: [id], onDelete: Cascade)
  sender     User     @relation("MessageSender", fields: [senderId], references: [id], onDelete: Cascade)

  @@index([senderId])
  @@index([receiverId])
  @@map("messages")
}

model SupportTicket {
  id        String   @id @default(cuid())
  subject   String
  message   String
  status    String   @default("OPEN")
  priority  String   @default("MEDIUM")
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("support_tickets")
}

model ActivityLog {
  id        String   @id @default(cuid())
  action    String
  details   String?
  ipAddress String?
  userId    String
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
  @@map("activity_logs")
}

model TeacherEducation {
  id          String   @id @default(cuid())
  degree      String
  institution String
  field       String
  year        Int
  userId      String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("teacher_education")
}

model TeacherFinancial {
  id                    String    @id @default(cuid())
  bank                  String
  agency                String
  account               String
  accountType           String
  pixKey                String?
  userId                String    @unique
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  subscriptionStatus    String    @default("inactive")
  plan                  String    @default("free")
  subscriptionStartDate DateTime?
  subscriptionExpiresAt DateTime?
  trialEndsAt           DateTime?
  lastPaymentDate       DateTime?
  paymentMethod         String?
  maxStudents           Int       @default(10)
  maxStorage            Int       @default(1000)
  canUploadLogo         Boolean   @default(false)
  canCustomizeDomain    Boolean   @default(false)
  canAccessAnalytics    Boolean   @default(false)
  stripeConnectAccountId String?
  connectOnboardingComplete Boolean @default(false)
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("teacher_financial")
}

model UserTheme {
  id                String          @id @default(cuid())
  userId            String          @unique
  presetId          String          @default("academic-blue")
  cardStyle         CardStyle       @default(FLAT)
  cardShadow        ShadowIntensity @default(NONE)
  cardBorder        Boolean         @default(true)
  card3D            Boolean         @default(false)
  cardGlass         Boolean         @default(false)
  spacing           Spacing         @default(COMFORTABLE)
  borderRadius      BorderRadius    @default(MEDIUM)
  animationsEnabled Boolean         @default(true)
  animationSpeed    AnimationSpeed  @default(NORMAL)
  hoverEffects      Boolean         @default(true)
  transitionEasing  String          @default("ease-in-out")
  customColors      Json?
  fontFamily        String?
  fontSize          FontSize        @default(NORMAL)
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  user              User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([presetId])
  @@map("user_themes")
}

model Payment {
  id                    String               @id @default(cuid())
  userId                String
  courseId              String?
  stripePaymentId       String?              @unique
  checkoutSessionId     String?
  studentSubscriptionId String?
  teacherSubscriptionId String?
  amount                Float
  currency              String               @default("BRL")
  type                  String               @default("course")
  paymentMethod         String
  status                String               @default("pending")
  stripeIntentId        String?
  stripeStatus          String?
  metadata              Json?
  isTest                Boolean              @default(false) // Indica se é pagamento de teste
  createdAt             DateTime             @default(now())
  updatedAt             DateTime             @updatedAt
  invoice               Invoice?
  checkoutSession       CheckoutSession?     @relation(fields: [checkoutSessionId], references: [id])
  course                Course?              @relation(fields: [courseId], references: [id])
  studentSubscription   StudentSubscription? @relation(fields: [studentSubscriptionId], references: [id])
  teacherSubscription   TeacherSubscription? @relation(fields: [teacherSubscriptionId], references: [id])
  user                  User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  advertisement         Advertisement?

  @@index([userId])
  @@index([courseId])
  @@index([stripePaymentId])
  @@index([checkoutSessionId])
  @@index([studentSubscriptionId])
  @@index([teacherSubscriptionId])
  @@index([status])
  @@map("payments")
}

model Payout {
  id           String   @id @default(cuid())
  teacherId    String
  periodStart  DateTime
  periodEnd    DateTime
  amount       Float
  currency     String   @default("BRL")
  status       String   @default("pending") // pending, paid, failed
  transferId   String?  // Stripe transfer id ou PSP id
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  teacher      User     @relation(fields: [teacherId], references: [id], onDelete: Cascade)

  @@index([teacherId])
  @@index([status])
  @@map("payouts")
}

model Invoice {
  id            String    @id @default(cuid())
  userId        String
  paymentId     String    @unique
  courseId      String?
  invoiceNumber String    @unique
  amount        Float
  currency      String    @default("BRL")
  status        String    @default("pending")
  issuedAt      DateTime  @default(now())
  dueAt         DateTime
  paidAt        DateTime?
  description   String?
  notes         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  course        Course?   @relation(fields: [courseId], references: [id])
  payment       Payment   @relation(fields: [paymentId], references: [id], onDelete: Cascade)
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([paymentId])
  @@index([invoiceNumber])
  @@index([courseId])
  @@index([status])
  @@map("invoices")
}

model TeacherSubscription {
  id               String            @id @default(cuid())
  userId           String            @unique
  stripeSubId      String?           @unique
  plan             String
  status           String            @default("inactive")
  startDate        DateTime          @default(now())
  renewDate        DateTime?
  cancelDate       DateTime?
  price            Float?
  currency         String            @default("BRL")
  interval         String            @default("month")
  stripePriceId    String?
  latestInvoiceId  String?
  stripeCustomerId String?
  stripeStatus     String?
  metadata         Json?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  checkoutSessions CheckoutSession[]
  payments         Payment[]
  user             User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([stripeSubId])
  @@index([stripePriceId])
  @@index([status])
  @@map("teacher_subscriptions")
}

model StudentSubscription {
  id                 String            @id @default(cuid())
  userId             String            @unique
  stripeSubId        String?           @unique
  stripeCustomerId   String?
  stripePriceId      String?
  plan               String
  status             String            @default("inactive")
  price              Float
  currency           String            @default("BRL")
  interval           String            @default("month")
  currentPeriodStart DateTime?
  currentPeriodEnd   DateTime?
  cancelAt           DateTime?
  cancelAtPeriodEnd  Boolean           @default(false)
  trialEndsAt        DateTime?
  metadata           Json?
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt
  checkoutSessions   CheckoutSession[]
  payments           Payment[]
  user               User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([stripeSubId])
  @@index([stripePriceId])
  @@index([status])
  @@map("student_subscriptions")
}

model StudentEnrollmentPayment {
  id              String   @id @default(cuid())
  enrollmentId    String   @unique
  userId          String
  courseId        String
  amount          Float
  currency        String   @default("BRL")
  paymentDate     DateTime @default(now())
  stripePaymentId String?
  status          String   @default("completed")
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  course          Course   @relation(fields: [courseId], references: [id])
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([courseId])
  @@index([enrollmentId])
  @@map("student_enrollment_payments")
}

model CheckoutSession {
  id                    String               @id @default(cuid())
  userId                String
  courseId              String?
  studentSubscriptionId String?
  teacherSubscriptionId String?
  stripeSessionId       String?              @unique
  stripeCustomerId      String?
  paymentIntentId       String?
  mode                  String               @default("payment")
  status                String               @default("pending")
  amount                Float?
  currency              String               @default("BRL")
  url                   String?
  expiresAt             DateTime?
  metadata              Json?
  createdAt             DateTime             @default(now())
  updatedAt             DateTime             @updatedAt
  course                Course?              @relation(fields: [courseId], references: [id])
  studentSubscription   StudentSubscription? @relation(fields: [studentSubscriptionId], references: [id])
  teacherSubscription   TeacherSubscription? @relation(fields: [teacherSubscriptionId], references: [id])
  user                  User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  payments              Payment[]

  @@index([userId])
  @@index([courseId])
  @@index([stripeSessionId])
  @@index([status])
  @@map("checkout_sessions")
}

model GithubIntegration {
  id             String    @id @default(cuid())
  userId         String    @unique
  githubUserId   String    @unique
  githubUsername String
  accessToken    String
  refreshToken   String?
  tokenExpiresAt DateTime?
  connectedAt    DateTime  @default(now())
  lastSyncedAt   DateTime?
  isConnected    Boolean   @default(true)
  repositories   Json?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  user           User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([githubUserId])
  @@map("github_integrations")
}

model SystemLog {
  id          String   @id @default(cuid())
  level       String
  component   String
  message     String
  description String?
  userId      String?
  metadata    Json?
  stackTrace  String?
  createdAt   DateTime @default(now())
  user        User?    @relation(fields: [userId], references: [id])

  @@index([level])
  @@index([component])
  @@index([userId])
  @@index([createdAt])
  @@map("system_logs")
}

model DeveloperMetrics {
  id           String   @id @default(cuid())
  component    String
  responseTime Int
  statusCode   Int?
  errorRate    Float?
  successCount Int      @default(0)
  errorCount   Int      @default(0)
  createdAt    DateTime @default(now())

  @@index([component])
  @@index([createdAt])
  @@map("developer_metrics")
}

model SystemConfig {
  id                  String   @id @default(cuid())
  key                 String   @unique @default("system")
  companyName         String   @default("SM Educacional")
  systemName          String   @default("SM Educacional")
  companyEmail        String?
  companyPhone        String?
  companyAddress      String?
  logoUrl             String?
  faviconUrl          String?
  loginBgUrl          String?
  primaryColor        String?  @default("#3B82F6")
  secondaryColor      String?  @default("#10B981")
  metaTitle           String?
  metaDescription     String?
  metaKeywords        String?
  facebookUrl         String?
  instagramUrl        String?
  linkedinUrl         String?
  twitterUrl          String?
  youtubeUrl          String?
  maintenanceMode     Boolean  @default(false)
  registrationEnabled Boolean  @default(true)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  publicTheme         Json?
  coursesDescription  String?  @default("Descubra cursos incríveis para alavancar sua carreira")
  coursesTitle        String?  @default("Nossos Cursos")
  homeDescription     String?  @default("Transforme seu futuro com educação de qualidade")
  homeTitle           String?  @default("Bem-vindo ao SM Educacional")
  loginDescription    String?  @default("Entre com suas credenciais para acessar sua conta")
  loginTitle          String?  @default("Bem-vindo de volta")
  navbarBgUrl         String?
  promotedCourseId    String?
  promotedCourse      Course?  @relation("PromotedCourse", fields: [promotedCourseId], references: [id])
  registerDescription String?  @default("Comece sua jornada de aprendizado hoje")
  registerTitle       String?  @default("Crie sua conta")
  themePresetId       String?  @default("academic-blue")
  // Configurações de mensalidade e planos
  freePlanCommission  Float    @default(0.15) // Taxa padrão plano Free (15%)
  basicPlanPrice      Float    @default(9900) // R$ 99/mês em centavos
  proPlanPrice        Float    @default(19900) // R$ 199/mês em centavos
  premiumPlanPrice    Float    @default(39900) // R$ 399/mês em centavos
  // Configurações de anúncios
  adSlotPrice         Float    @default(19900) // Preço base por slot/mês
  adSlotsAvailable    Int      @default(6) // Total de slots no catálogo
  // Configurações Stripe e Pagamentos Internacionais
  stripePublishableKey String?
  stripeSecretKey      String?
  stripeWebhookSecret  String?
  defaultCurrency      String   @default("BRL") // Moeda padrão
  supportedCurrencies  Json?    @default("[\"BRL\",\"USD\",\"EUR\"]") // Lista de moedas suportadas
  pricesByCountry      Json?    // Preços específicos por país/moeda
  paymentMethods       Json?    @default("{\"card\":true,\"boleto\":true,\"pix\":true}") // Métodos de pagamento habilitados
  taxConfiguration     Json?    // Configurações de impostos por país
  stripeAccountId      String?  // Stripe Connect Account ID (para marketplace)
  autoPayoutEnabled    Boolean  @default(false) // Repasse automático para professores
  payoutSchedule       String   @default("weekly") // daily, weekly, monthly

  @@map("system_configs")
}

enum UserRole {
  STUDENT
  TEACHER
  ADMIN
}

enum EnrollmentStatus {
  ACTIVE
  COMPLETED
  CANCELLED
}

enum ActivityType {
  QUIZ
  ASSIGNMENT
  EXAM
}

enum NotificationType {
  COURSE
  ACTIVITY
  GRADE
  SYSTEM
  MESSAGE
  PAYMENT
}

enum CardStyle {
  FLAT
  ELEVATED
  BORDERED
  GLASS
  NEON
  GRADIENT
}

enum ShadowIntensity {
  NONE
  LIGHT
  MEDIUM
  STRONG
  XL
}

enum Spacing {
  COMPACT
  COMFORTABLE
  SPACIOUS
  EXTRA_SPACIOUS
}

enum BorderRadius {
  NONE
  SMALL
  MEDIUM
  LARGE
  XL
  FULL
}

enum AnimationSpeed {
  DISABLED
  FAST
  NORMAL
  SLOW
  VERY_SLOW
}

enum FontSize {
  SMALL
  NORMAL
  LARGE
  EXTRA_LARGE
}

enum AdSlotPosition {
  HERO_BANNER       // Banner principal topo do catálogo
  SIDEBAR_TOP       // Sidebar direita topo
  SIDEBAR_MIDDLE    // Sidebar direita meio
  GRID_FEATURED_1   // Grid destaque posição 1
  GRID_FEATURED_2   // Grid destaque posição 2
  GRID_FEATURED_3   // Grid destaque posição 3
}

enum AdStatus {
  DRAFT
  SCHEDULED
  ACTIVE
  PAUSED
  COMPLETED
  CANCELLED
}

model Advertisement {
  id              String          @id @default(cuid())
  courseId        String
  teacherId       String
  slotPosition    AdSlotPosition
  status          AdStatus        @default(DRAFT)
  priority        Int             @default(0) // Maior prioridade = mais destaque
  startDate       DateTime
  endDate         DateTime
  price           Float           // Valor pago pelo slot
  isPaid          Boolean         @default(false)
  paymentId       String?         @unique
  clicks          Int             @default(0)
  impressions     Int             @default(0)
  conversions     Int             @default(0) // Matrículas vindas do anúncio
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  course          Course          @relation(fields: [courseId], references: [id], onDelete: Cascade)
  teacher         User            @relation("TeacherAds", fields: [teacherId], references: [id], onDelete: Cascade)
  payment         Payment?        @relation(fields: [paymentId], references: [id])
  analytics       AdAnalytics[]

  @@map("advertisements")
}

model AdAnalytics {
  id              String        @id @default(cuid())
  adId            String
  date            DateTime      @default(now())
  clicks          Int           @default(0)
  impressions     Int           @default(0)
  conversions     Int           @default(0)
  ctr             Float         @default(0) // Click-through rate
  conversionRate  Float         @default(0)
  ad              Advertisement @relation(fields: [adId], references: [id], onDelete: Cascade)

  @@index([adId, date])
  @@map("ad_analytics")
}

// Audit Log: Registra todas as operações sensíveis (financeiras, acesso, deletions)
// Implementa system-blueprint.md seção 7 "Módulo Administrativo & Governança"
model AuditLog {
  id          String    @id @default(cuid())
  userId      String
  action      String
  targetId    String?
  targetType  String?
  changes     Json?
  metadata    Json?
  ipAddress   String?
  createdAt   DateTime  @default(now())
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([action])
  @@index([targetId])
  @@index([createdAt])
  @@map("audit_logs")
}

// Notification Log: Registra envio de e-mails críticos
// Implementa system-blueprint.md seção 6 "Módulo de Comunicação (Resend)"
model NotificationLog {
  id                String    @id @default(cuid())
  emailAddress      String
  emailType         String
  status            String    @default("SENT")
  resendMessageId   String?
  error             String?
  userId            String?
  sentAt            DateTime  @default(now())
  user              User?     @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([emailAddress])
  @@index([emailType])
  @@index([status])
  @@index([sentAt])
  @@index([userId])
  @@map("notification_logs")
}